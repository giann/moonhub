local a={}a.__index=function(self,b)return a[b]or(function()local c={}rawset(self,b,c)return c end)()end;function a:register(d,e)self[d][e]=e;return e end;function a:emit(d,...)for e in pairs(self[d])do e(...)end end;function a:remove(d,...)local e={...}for f=1,select('#',...)do self[d][e[f]]=nil end end;function a:clear(...)local d={...}for f=1,select('#',...)do self[d[f]]={}end end;function a:emitPattern(g,...)for d in pairs(self)do if d:match(g)then self:emit(d,...)end end end;function a:registerPattern(g,e)for d in pairs(self)do if d:match(g)then self:register(d,e)end end;return e end;function a:removePattern(g,...)for d in pairs(self)do if d:match(g)then self:remove(d,...)end end end;function a:clearPattern(g)for d in pairs(self)do if d:match(g)then self[d]={}end end end;function a.new()return setmetatable({},a)end;local h=a.new()local i={}for j in pairs(a)do if j~="__index"then i[j]=function(...)return h[j](h,...)end end end;return setmetatable(i,{__call=a.new})
