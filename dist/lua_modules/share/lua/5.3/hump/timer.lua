local a={}a.__index=a;local function b()end;function a:update(c)local d={}for e in pairs(self.functions)do e.time=e.time+c;e.during(c,math.max(e.limit-e.time,0))while e.time>=e.limit and e.count>0 do if e.after(e.after)==false then e.count=0;break end;e.time=e.time-e.limit;e.count=e.count-1 end;if e.count==0 then table.insert(d,e)end end;for f=1,#d do self.functions[d[f]]=nil end end;function a:during(g,h,i)local e={time=0,during=h,after=i or b,limit=g,count=1}self.functions[e]=true;return e end;function a:after(g,j)return self:during(g,b,j)end;function a:every(g,i,k)local k=k or math.huge;local e={time=0,during=b,after=i,limit=g,count=k}self.functions[e]=true;return e end;function a:cancel(e)self.functions[e]=nil end;function a:clear()self.functions={}end;function a:script(l)local m=coroutine.wrap(l)m(function(n)self:after(n,m)coroutine.yield()end)end;a.tween=setmetatable({out=function(l)return function(o,...)return 1-l(1-o,...)end end,chain=function(p,q)return function(o,...)return(o<.5 and p(2*o,...)or 1+q(2*o-1,...))*.5 end end,linear=function(o)return o end,quad=function(o)return o*o end,cubic=function(o)return o*o*o end,quart=function(o)return o*o*o*o end,quint=function(o)return o*o*o*o*o end,sine=function(o)return 1-math.cos(o*math.pi/2)end,expo=function(o)return 2^(10*(o-1))end,circ=function(o)return 1-math.sqrt(1-o*o)end,back=function(o,r)r=r or 1.70158;return o*o*((r+1)*o-r)end,bounce=function(o)local s,t=7.5625,1/2.75;return math.min(s*o^2,s*(o-1.5*t)^2+.75,s*(o-2.25*t)^2+.9375,s*(o-2.625*t)^2+.984375)end,elastic=function(o,u,v)u,v=u and math.max(1,u)or 1,v or.3;return-u*math.sin(2*math.pi/v*(o-1)-math.asin(1/u))*2^(10*(o-1))end},{__call=function(w,self,x,y,z,A,i,...)local function B(y,z,C)for D,E in pairs(z)do local F=y[D]assert(type(E)==type(F),'Type mismatch in field "'..D..'".')if type(E)=='table'then B(F,E,C)else local G,H=pcall(function()return(E-F)*1 end)assert(G,'Field "'..D..'" does not support arithmetic operations')C[#C+1]={y,D,H}end end;return C end;A=w[A or'linear']local I,n,J=B(y,z,{}),0,{...}local K=0;return self:during(x,function(c)n=n+c;local o=A(math.min(1,n/x),unpack(J))local L=o-K;K=o;for M,N in ipairs(I)do local F,O,H=unpack(N)F[O]=F[O]+H*L end end,i)end,__index=function(P,O)if type(O)=='function'then return O end;assert(type(O)=='string','Method must be function or string.')if rawget(P,O)then return rawget(P,O)end;local function Q(R,l)local A=rawget(P,O:match(R))if A then return l(A)end;return nil end;local C,S=rawget(P,'out'),rawget(P,'chain')return Q('^in%-([^-]+)$',function(...)return...end)or Q('^out%-([^-]+)$',C)or Q('^in%-out%-([^-]+)$',function(l)return S(l,C(l))end)or Q('^out%-in%-([^-]+)$',function(l)return S(C(l),l)end)or error('Unknown interpolation method: '..O)end})function a.new()return setmetatable({functions={},tween=a.tween},a)end;local T=a.new()local U={}for D in pairs(a)do if D~="__index"then U[D]=function(...)return T[D](T,...)end end end;U.tween=setmetatable({},{__index=a.tween,__newindex=function(D,E)a.tween[D]=E end,__call=function(n,...)return T:tween(...)end})return setmetatable(U,{__call=a.new})
